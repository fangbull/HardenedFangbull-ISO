# Logrotate configuration for Hardened Fangbull IDS
# Prevents log explosion and manages disk space efficiently

# Main IDS logs
/var/log/fangbull-ids/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 10M
    
    postrotate
        # Signal IDS processes to reopen log files if needed
        /usr/bin/systemctl reload-or-restart fangbull-ids-* 2>/dev/null || true
    endscript
}

# Individual IDS component logs with different retention policies
/var/log/fangbull-ids/cron_dropper.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-ids/ghost_service.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-ids/hidden_binary.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-ids/malscript.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-ids/memory_resident.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-ids/netlink_monitor.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-ids/rootshell_injection.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-ids/shell_fork_bomb.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-ids/tty_hijack.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-ids/zombie_process.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

# Cache and temporary files - more aggressive cleanup
/var/log/fangbull-ids/*.cache {
    daily
    rotate 1
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 1M
}

# Sample directories - weekly cleanup
/var/log/fangbull-ids/*/samples/* {
    weekly
    rotate 2
    compress
    delaycompress
    missingok
    notifempty
    maxsize 50M
    
    prerotate
        # Clean up old samples before rotation
        find /var/log/fangbull-ids/*/samples/ -type f -mtime +7 -delete 2>/dev/null || true
    endscript
}

# Intelligence databases - monthly backup
/var/log/fangbull-ids/*.db {
    monthly
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 20M
}

# System management tool logs
/var/log/fangbull-sys.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 10M
}

/var/log/fangbull-usbguard.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-jails.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 5M
}

/var/log/fangbull-crypt.log {
    weekly
    rotate 2
    compress
    delaycompress
    missingok
    notifempty
    create 640 root root
    maxsize 2M
}
